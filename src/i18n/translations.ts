export type SupportedLanguage = 'en' | 'es';

export const fallbackLanguage: SupportedLanguage = 'en';

type TranslationNode = string | { [key: string]: TranslationNode };

const dictionary: Record<SupportedLanguage, TranslationNode> = {
  en: {
    common: {
      cancel: 'Cancel',
      close: 'Close',
      download: 'Download',
      downloadAdd: 'Download & add to playlist',
      removeFromPlaylist: 'Remove from this playlist',
      removeFromLibrary: 'Remove from library',
      deletePermanent: 'Delete permanently',
      addToPlaylist: 'Add to playlist',
      addedToPlaylist: 'Track added to playlist.',
      unableToAddTrack: 'Unable to add track. Please try again later.',
      error: 'Something went wrong.',
      ok: 'OK',
      unavailable: 'Unavailable',
      noPlaylists: 'No playlists available.',
      selectPlaylist: 'Select playlist',
      previewing: 'Previewing…',
    },
    home: {
      greeting: 'Good Evening',
      playlists: 'Your Playlists',
      showAll: 'Show all',
      recentlyAdded: 'Recently Added',
      play: 'Play All',
      offline: 'Offline mode',
      stats: {
        songs: 'Songs',
        artists: 'Artists',
        albums: 'Albums',
        storage: 'Storage',
      },
    },
    tabs: {
      Home: 'Home',
      Library: 'Library',
      Create: 'Create',
      Search: 'Search',
      Settings: 'Settings',
    },
    create: {
      title: 'Start a new playlist',
      subtitle: 'Give it a name, add a description, and jump right in.',
      helper: 'You will be taken to the playlist after it is created.',
      openModal: 'Start new playlist',
      modalTitle: 'Create a playlist',
      createButton: 'Save playlist',
      success: 'Playlist created.',
      error: 'Unable to create playlist.',
      nameRequired: 'Please enter a playlist name.',
    },
    search: {
      placeholderLocal: 'Search your library',
      placeholderOnline: 'Search online catalog',
      downloadQueued: 'Track added to the download queue.',
      downloadFailed: 'Failed to queue download.',
      chooseAction: 'Choose an action',
      selectPlaylist: 'Select playlist',
      noPlaylistsAction: 'Create a playlist first.',
      noResults: 'No results found',
      searchForMusic: 'Search for music',
      discover: 'Discover millions of tracks online',
      localDescription: 'Find songs in your library',
      noResultsDescription: 'Try different keywords or check your spelling',
      loading: 'Searching…',
      downloadOnly: 'Download',
      downloadAdd: 'Download & add to playlist',
      saveOffline: 'Save to offline downloads',
      chooseStorage: 'Choose where to store this track',
      modes: {
        local: 'Library',
        online: 'Online',
      },
      types: {
        track: 'Songs',
        artist: 'Artists',
        album: 'Albums',
      },
    },
    settings: {
      serverTitle: 'Server',
      serverSubtitle: 'Point the app to your Noxa Music backend.',
      serverPlaceholder: 'https://stream.noxamusic.com',
      saveServer: 'Save Server URL',
      serverSuccess: 'Server URL updated.',
      serverInvalid: 'Please enter a valid server address.',
      accountTitle: 'Account',
      signOut: 'Sign Out',
      languageTitle: 'Language',
      languageSubtitle: 'Choose the language for the app.',
      english: 'English',
      spanish: 'Español',
    },
    library: {
      artists: 'Artists',
      albums: 'Albums',
      playlists: 'Playlists',
      downloads: 'Downloads',
      tracks: 'Tracks',
      loading: 'Loading library…',
      error: 'Failed to load library',
      emptyPlaylist: 'No tracks in this playlist yet.',
      downloadStarted: 'Playlist is being downloaded for offline playback.',
      noTracksDownload: 'Add tracks to this playlist before downloading.',
      unknownArtist: 'Unknown Artist',
      unknownAlbum: 'Unknown Album',
      downloadsHint: 'Download content while online to access it here.',
      libraryHint: 'Add music to your library to see it here.',
      noData: 'No {{view}} found yet',
      noOfflineData: 'No offline {{view}} available',
    },
    playlist: {
      edit: 'Edit',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      downloaded: 'Downloaded',
      saveOffline: 'Save Offline',
      downloading: 'Downloading {{percent}}%',
      loading: 'Loading playlist…',
      updated: 'Playlist updated.',
      untitled: 'Untitled Playlist',
      descriptionPlaceholder: 'Description (optional)',
      namePlaceholder: 'Playlist name',
      removePrompt: 'Remove "{{track}}" from this playlist?',
      removeTitle: 'Remove Track',
      trackCount: '{{count}} songs',
      optionsTitle: 'Track options',
      choosePlaylist: 'Choose playlist',
      noOtherPlaylists: 'No other playlists available.',
      deleteConfirm: 'Are you sure you want to delete this playlist?',
      noTracksTitle: 'No tracks',
      removeOfflineTitle: 'Remove offline copies',
      removeOfflineConfirm: 'Delete this playlist from offline cache?',
      emptyCta: 'Add songs',
    },
    nowPlaying: {
      title: 'Now Playing',
      placeholderTitle: 'Nothing playing',
      placeholderArtist: '—',
      upNext: 'Up Next',
      queueEmpty: 'Queue is empty',
      trackActions: 'Track Actions',
      selectPlaylist: 'Select playlist',
      noPlaylists: 'No playlists available',
      removeFromLibrary: 'Remove from library',
      delete: 'Delete permanently',
    },
    downloads: {
      title: 'Downloads',
      subtitle: 'Track progress or import Spotify links',
      empty: 'No downloads yet.',
      emptyHint: 'Tap + to import a Spotify link.',
      statusMessage: 'Offline download ready',
      optionsTitle: 'Import Music',
      optionsSubtitle: 'Pull tracks straight from Spotify',
      trackCheck: 'Checking downloads…',
    },
    auth: {
      welcome: 'Welcome to Noxa Music',
    },
  },
  es: {
    common: {
      cancel: 'Cancelar',
      close: 'Cerrar',
      download: 'Descargar',
      downloadAdd: 'Descargar y añadir a lista',
      removeFromPlaylist: 'Quitar de esta lista',
      removeFromLibrary: 'Quitar de la biblioteca',
      deletePermanent: 'Eliminar permanentemente',
      addToPlaylist: 'Añadir a una lista',
      addedToPlaylist: 'Canción añadida a la lista.',
      unableToAddTrack: 'No se pudo añadir la canción. Inténtalo nuevamente.',
      error: 'Algo salió mal.',
      ok: 'Aceptar',
      unavailable: 'No disponible',
      noPlaylists: 'No hay listas disponibles.',
      selectPlaylist: 'Elegir lista',
      previewing: 'Previsualizando…',
    },
    home: {
      greeting: 'Buenas noches',
      playlists: 'Tus listas',
      showAll: 'Ver todo',
      recentlyAdded: 'Recientemente añadido',
      play: 'Reproducir todo',
      offline: 'Modo sin conexión',
      stats: {
        songs: 'Canciones',
        artists: 'Artistas',
        albums: 'Álbumes',
        storage: 'Almacenamiento',
      },
    },
    tabs: {
      Home: 'Inicio',
      Library: 'Biblioteca',
      Create: 'Crear',
      Search: 'Buscar',
      Settings: 'Ajustes',
    },
    create: {
      title: 'Crea una nueva lista',
      subtitle: 'Ponle nombre, añade una descripción y comienza.',
      helper: 'Irás directo a la lista una vez guardada.',
      openModal: 'Crear lista',
      modalTitle: 'Nueva lista de reproducción',
      createButton: 'Guardar lista',
      success: 'Lista creada.',
      error: 'No se pudo crear la lista.',
      nameRequired: 'Ingresa un nombre para la lista.',
    },
    search: {
      placeholderLocal: 'Busca en tu biblioteca',
      placeholderOnline: 'Busca en el catálogo en línea',
      downloadQueued: 'Canción añadida a la cola de descargas.',
      downloadFailed: 'Error al añadir a la cola.',
      chooseAction: 'Elige una acción',
      selectPlaylist: 'Selecciona una lista',
      noPlaylistsAction: 'Crea una lista primero.',
      noResults: 'No se encontraron resultados',
      searchForMusic: 'Busca música',
      discover: 'Descubre millones de canciones en línea',
      localDescription: 'Encuentra canciones en tu biblioteca',
      noResultsDescription: 'Prueba con otras palabras o revisa la ortografía',
      loading: 'Buscando…',
      downloadOnly: 'Descargar',
      downloadAdd: 'Descargar y añadir a lista',
      saveOffline: 'Guardar para escuchar sin conexión',
      chooseStorage: 'Elige dónde guardar esta canción',
      modes: {
        local: 'Biblioteca',
        online: 'En línea',
      },
      types: {
        track: 'Canciones',
        artist: 'Artistas',
        album: 'Álbumes',
      },
    },
    settings: {
      serverTitle: 'Servidor',
      serverSubtitle: 'Apunta la app a tu backend de Noxa Music.',
      serverPlaceholder: 'https://stream.noxamusic.com',
      saveServer: 'Guardar URL del servidor',
      serverSuccess: 'Servidor actualizado.',
      serverInvalid: 'Introduce una dirección válida.',
      accountTitle: 'Cuenta',
      signOut: 'Cerrar sesión',
      languageTitle: 'Idioma',
      languageSubtitle: 'Elige el idioma de la app.',
      english: 'English',
      spanish: 'Español',
    },
    library: {
      artists: 'Artistas',
      albums: 'Álbumes',
      playlists: 'Listas',
      downloads: 'Descargas',
      tracks: 'Canciones',
      loading: 'Cargando biblioteca…',
      error: 'No se pudo cargar la biblioteca',
      emptyPlaylist: 'Aún no hay canciones en esta lista.',
      downloadStarted: 'La lista se está descargando para usar sin conexión.',
      noTracksDownload: 'Añade canciones antes de descargar.',
      unknownArtist: 'Artista desconocido',
      unknownAlbum: 'Álbum desconocido',
      downloadsHint: 'Descarga contenido estando en línea para verlo aquí.',
      libraryHint: 'Añade música a tu biblioteca para verla aquí.',
      noData: 'No se encontraron {{view}}',
      noOfflineData: 'No hay {{view}} sin conexión',
    },
    playlist: {
      edit: 'Editar',
      save: 'Guardar',
      cancel: 'Cancelar',
      delete: 'Eliminar',
      downloaded: 'Descargado',
      saveOffline: 'Guardar sin conexión',
      downloading: 'Descargando {{percent}}%',
      loading: 'Cargando lista…',
      updated: 'Lista actualizada.',
      untitled: 'Lista sin nombre',
      descriptionPlaceholder: 'Descripción (opcional)',
      namePlaceholder: 'Nombre de la lista',
      removePrompt: '¿Quitar "{{track}}" de esta lista?',
      removeTitle: 'Quitar canción',
      trackCount: '{{count}} canciones',
      optionsTitle: 'Opciones de la canción',
      choosePlaylist: 'Elige una lista',
      noOtherPlaylists: 'No hay otras listas disponibles.',
      deleteConfirm: '¿Quieres eliminar esta lista?',
      noTracksTitle: 'Sin canciones',
      removeOfflineTitle: 'Quitar descargas',
      removeOfflineConfirm: '¿Eliminar esta lista de la caché sin conexión?',
      emptyCta: 'Añadir canciones',
    },
    nowPlaying: {
      title: 'Reproduciendo',
      placeholderTitle: 'Nada en reproducción',
      placeholderArtist: '—',
      upNext: 'A continuación',
      queueEmpty: 'La cola está vacía',
      trackActions: 'Acciones',
      selectPlaylist: 'Selecciona una lista',
      noPlaylists: 'No hay listas disponibles',
      removeFromLibrary: 'Quitar de la biblioteca',
      delete: 'Eliminar permanentemente',
    },
    downloads: {
      title: 'Descargas',
      subtitle: 'Revisa el progreso o importa enlaces de Spotify',
      empty: 'Aún no hay descargas.',
      emptyHint: 'Pulsa + para importar un enlace de Spotify.',
      statusMessage: 'Descarga sin conexión lista',
      optionsTitle: 'Importar música',
      optionsSubtitle: 'Trae canciones directamente de Spotify',
      trackCheck: 'Comprobando descargas…',
    },
    auth: {
      welcome: 'Bienvenido a Noxa Music',
    },
  },
};

const getValueFromKey = (node: TranslationNode, key: string): string | undefined => {
  const parts = key.split('.');
  let current: TranslationNode | undefined = node;
  for (const part of parts) {
    if (!current || typeof current === 'string') {
      return typeof current === 'string' ? current : undefined;
    }
    current = current[part];
  }
  return typeof current === 'string' ? current : undefined;
};

export const translate = (
  language: SupportedLanguage,
  key: string,
  vars?: Record<string, string | number>,
) => {
  const langObject = dictionary[language] ?? dictionary[fallbackLanguage];
  const fallbackObject = dictionary[fallbackLanguage];
  const template =
    getValueFromKey(langObject, key) ?? getValueFromKey(fallbackObject, key) ?? key;
  if (!vars) {
    return template;
  }
  return template.replace(/\{\{\s*(\w+)\s*\}\}/g, (_, variable) =>
    vars[variable] !== undefined ? String(vars[variable]) : '',
  );
};
